<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui">

<h:head>
    <title>Student CRUD Application</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .form-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fafafa;
        }
        .table-section {
            margin-top: 30px;
        }
        h1, h2 {
            color: #333;
        }
        .ui-panel .ui-panel-titlebar {
            background: #337ab7;
            color: white;
        }
    </style>
    <script type="text/javascript">
        function handleUpdateComplete(args) {
            if (args && !args.validationFailed) {
                PF('editDialog').hide();
            }
        }
    </script>
</h:head>

<h:body>
    <div class="container">
        <h1>Student Management System</h1>
        
        <!-- Messages -->
        <p:messages id="messages" showDetail="true" autoUpdate="true" closable="true"/>
        
        <!-- Student Form -->
        <div class="form-section">
            <h2>Add New Student</h2>
            <h:form id="studentForm">
                <p:panelGrid columns="2" cellpadding="5" styleClass="ui-noborder">
                    
                    <p:outputLabel for="studentName" value="Student Name:" />
                    <p:inputText id="studentName" value="#{studentController.student.studentName}" 
                                required="true" requiredMessage="Student name is required"
                                style="width: 200px;"/>
                    
                    <p:outputLabel for="studentAddress" value="Student Address:" />
                    <p:inputTextarea id="studentAddress" value="#{studentController.student.studentAddress}" 
                                    required="true" requiredMessage="Student address is required"
                                    rows="3" cols="30"/>
                    
                    <p:outputLabel for="studentClass" value="Student Class:" />
                    <p:selectOneMenu id="studentClass" value="#{studentController.student.studentClass}" 
                                    converter="studentClassConverter"
                                    required="true" requiredMessage="Please select a class"
                                    style="width: 200px;">
                        <f:selectItem itemLabel="-- Select Class --" itemValue="#{null}" />
                        <f:selectItems value="#{studentController.classes}" 
                                      var="class" 
                                      itemLabel="#{class.className}" 
                                      itemValue="#{class}" />
                        <p:ajax listener="#{studentController.onClassChange}" 
                               update="subjectDropdown" />
                    </p:selectOneMenu>
                    
                    <p:outputLabel for="subject" value="Subject:" />
                    <p:selectOneMenu id="subjectDropdown" value="#{studentController.student.subject}" 
                                    converter="subjectConverter"
                                    required="true" requiredMessage="Please select a subject"
                                    style="width: 200px;">
                        <f:selectItem itemLabel="-- Select Subject --" itemValue="#{null}" />
                        <f:selectItems value="#{studentController.availableSubjects}" 
                                      var="subject" 
                                      itemLabel="#{subject.subjectName}" 
                                      itemValue="#{subject}" />
                    </p:selectOneMenu>
                    
                </p:panelGrid>
                
                <p:commandButton value="Save Student" 
                               actionListener="#{studentController.saveStudent}" 
                               update="studentForm,studentTable,messages"
                               style="margin-top: 10px;"
                               styleClass="ui-button-success"/>
            </h:form>
        </div>
        
        <!-- Students Table -->
        <div class="table-section">
            <h2>Students List</h2>
            <h:form id="tableForm">
                <p:dataTable id="studentTable" value="#{studentController.students}" var="student"
                           paginator="true" rows="10" paginatorPosition="bottom"
                           emptyMessage="No students found"
                           styleClass="ui-table ui-table-striped">
                    
                    <p:column headerText="ID" sortBy="#{student.id}">
                        <h:outputText value="#{student.id}" />
                    </p:column>
                    
                    <p:column headerText="Name" sortBy="#{student.studentName}">
                        <h:outputText value="#{student.studentName}" />
                    </p:column>
                    
                    <p:column headerText="Address" sortBy="#{student.studentAddress}">
                        <h:outputText value="#{student.studentAddress}" />
                    </p:column>
                    
                    <p:column headerText="Class" sortBy="#{student.studentClass.className}">
                        <h:outputText value="#{student.studentClass.className}" />
                    </p:column>
                    
                    <p:column headerText="Subject" sortBy="#{student.subject.subjectName}">
                        <h:outputText value="#{student.subject.subjectName}" />
                    </p:column>
                    
                    <p:column headerText="Actions" style="width: 150px;">
                        <p:commandButton value="Edit" 
                                       actionListener="#{studentController.editStudent(student)}"
                                       oncomplete="PF('editDialog').show()"
                                       update="editForm"
                                       styleClass="ui-button-warning"
                                       style="margin-right: 5px;"/>
                        
                        <p:commandButton value="Delete" 
                                       actionListener="#{studentController.deleteStudent(student)}"
                                       update="studentTable,messages"
                                       styleClass="ui-button-danger"
                                       onclick="return confirm('Are you sure you want to delete this student?')"/>
                    </p:column>
                </p:dataTable>
            </h:form>
        </div>
        
        <!-- Edit Dialog -->
        <p:dialog id="editDialog" widgetVar="editDialog" header="Edit Student" 
                 modal="true" resizable="false" width="500" height="400">
            <h:form id="editForm">
                <p:panelGrid columns="2" cellpadding="5" styleClass="ui-noborder">
                    
                    <p:outputLabel for="editStudentName" value="Student Name:" />
                    <p:inputText id="editStudentName" value="#{studentController.selectedStudent.studentName}" 
                                required="true" requiredMessage="Student name is required"
                                style="width: 200px;"/>
                    
                    <p:outputLabel for="editStudentAddress" value="Student Address:" />
                    <p:inputTextarea id="editStudentAddress" value="#{studentController.selectedStudent.studentAddress}" 
                                    required="true" requiredMessage="Student address is required"
                                    rows="3" cols="30"/>
                    
                    <p:outputLabel for="editStudentClass" value="Student Class:" />
                    <p:selectOneMenu id="editStudentClass" value="#{studentController.selectedStudent.studentClass}" 
                                    converter="studentClassConverter"
                                    required="true" requiredMessage="Please select a class"
                                    style="width: 200px;">
                        <f:selectItem itemLabel="-- Select Class --" itemValue="#{null}" />
                        <f:selectItems value="#{studentController.classes}" 
                                      var="class" 
                                      itemLabel="#{class.className}" 
                                      itemValue="#{class}" />
                        <p:ajax listener="#{studentController.onEditClassChange}" 
                               update="editSubjectDropdown" />
                    </p:selectOneMenu>
                    
                    <p:outputLabel for="editSubject" value="Subject:" />
                    <p:selectOneMenu id="editSubjectDropdown" value="#{studentController.selectedStudent.subject}" 
                                    converter="subjectConverter"
                                    required="true" requiredMessage="Please select a subject"
                                    style="width: 200px;">
                        <f:selectItem itemLabel="-- Select Subject --" itemValue="#{null}" />
                        <f:selectItems value="#{studentController.editAvailableSubjects}" 
                                      var="subject" 
                                      itemLabel="#{subject.subjectName}" 
                                      itemValue="#{subject}" />
                    </p:selectOneMenu>
                    
                </p:panelGrid>
                
                <div style="text-align: center; margin-top: 20px;">
                    <p:commandButton value="Update" 
                                   actionListener="#{studentController.updateStudent}" 
                                   update="editForm,studentTable,messages"
                                   oncomplete="handleUpdateComplete(args)"
                                   styleClass="ui-button-success"
                                   style="margin-right: 10px;"/>
                    
                    <p:commandButton value="Cancel" 
                                   onclick="PF('editDialog').hide()" 
                                   type="button"
                                   styleClass="ui-button-secondary"/>
                </div>
            </h:form>
        </p:dialog>
    </div>
</h:body>
</html>
